---------------------------------
mod_pubsub Release November, 2002
---------------------------------

Installing the mod_pubsub release is simple if you already have
experience configuring and running web servers.  You'll need a web
server with which to run the pubsub engine -- instructions for
configuring Apache 1.3 are below.  Other web servers may work but
have not been tested with this release.


------------
Installation
------------

0.  You will need Perl 5 or higher to be able to use this distribution.
You will also need a C compiler.


1.  You will need to install the libwww-perl collection for Perl 5.  This
is a set of Perl modules that provide a nice API for HTTP functions.  We
strongly recommend that you use CPAN, which will fetch and install all
dependencies for you.  CPAN may already be installed on your system; or
learn more and get it at http://www.cpan.org.

  cpan install Bundle::LWP


2.  Now install Apache itself.  We recommend that you enable dynamic
shared object support during configuration (see step 3 below).  This
will make it easier to also use other Apache modules and is no more
difficult to build and use.

  tar -zxvf apache_1.3.x.tar.gz
  cd apache_1.3.x
  ./configure --enable-module=so
  make
  make install


3.  Unless you have some deep philosophical opposition to running Perl
scripts inside Apache, and are willing to put up with tremendously
decreased performance to express your convictions, you will now need to
install the Apache Perl module, mod_perl (http://perl.apache.org).  We
recommend that you do so as a dynamic shared object.

  tar -zxvf mod_perl-1.xx.tar.gz
  cd mod_perl-1.xx
  perl Makefile.PL USE_APXS=1 WITH_APXS=/path/to/apache/bin/apxs EVERYTHING=1
  make
  make test
  make install

Make sure that the module is there at /path/to/apache/libexec/libperl.so,
and that there's a line in apache/conf/httpd.conf like this:

  LoadModule perl_module path/to/perl/module


4.  Extract the mod_pubsub tar file under your Apache document root.  It
will create a directory named mod_pubsub.


5.  Configure your Apache server to allow scripts in mod_pubsub/cgi-bin to
be parsed by mod_perl.  Your goal here is to get Apache to read .htaccess
files in mod_pubsub and especially mod_pubsub/cgi-bin.  In a stock Apache
installation, you should be able to do this by going to the Directory
section of your httpd.conf file (right below the DocumentRoot setting) and
setting AllowOverride to "Options" in all directory settings that affect
mod_pubsub.

At this point, your Apache and mod_perl should be working correctly.  To
check, view the following page:

  http://localhost/mod_pubsub/cgi-bin/testperl.cgi

You should see about a page of information about your Apache server.  If
you see a few lines of Perl instead, mod_perl is not enabled correctly.


6.  You need to create a subdirectory called mod_pubsub/kn_events and
make it writeable by the user that will be running the event router code,
typically "nobody" or "httpd".  The easiest way to do this is to make
the directory world-writeable; do not do this if you share your web
server with people you don't trust.  You can do this step by running the
Makefile in this directory or by the following commands:

  cd mod_pubsub
  mkdir kn_events
  chmod a+w kn_events

If you don't do this, none of the apps will work, the test suite will
fail, your server error log will rapidly fill with "Uncaught
exception" messages, and apps run with debugging turned on will
display "500 Internal Server Error" messages.


7. Now try testing your mod_pubsub server:

  http://localhost/mod_pubsub/cgi-bin/pubsub_test.cgi

You should see a list of tests.  All 55 tests should say "OK", with the
possible exception of the "replay" tests, which are flaky.

NOTE: This will fail if you have required HTTP authentication (as
described below.) To make it work, you should append a valid HTTP
username and password to the URL in index.html:

  http://localhost/mod_pubsub/cgi-bin/kn_test.cgi?user=knguest&password=knguest


8.  Try viewing a test app in kn_apps:

  http://localhost/mod_pubsub/kn_apps/chat2/index.html?kn_debug

You should see 4 frame windows.  The small one at lower-left should be
red and say "200 Watching topic".  The small one at lower-right should be
yellow.  The top frame window should be blank and beige.  You should be
able to type messages in the form and see them in the top frame.

If you are not seeing what you expected at this point, see the
Troubleshooting section below.


9.  At this point, all the Dynamic HTML apps listed in the index should
work.  However, chatroom, stocksoap, and vote determine usernames from
HTTP authentication; to take advantage of this (so not everybody is
"Anonymous User") requires configuring Apache to require password
authentication for access to the mod_pubsub instance.  You can do this
by adding something like the following to your Apache httpd.conf:

      <Directory "/wherever/you/installed/mod_pubsub">
          AuthType Basic
          AuthName "knownow-auth"
          AuthUserFile /wherever/you/installed/kn/sample.passwd
          Require valid-user
      </Directory>

WARNING: The included sample.passwd file contains a username and
password entry for user 'knguest' with the password 'knguest'.


---------------
Troubleshooting
---------------

Not Found error (The request URL /kn was not found on this server)
  .htaccess file not being authorized.  Check the directory section of
httpd.conf as described in step 5 above.


500 Internet Server Error
  Either .htaccess file not allowed or permissions on kn_events directory
are insufficient.  Stop and start Apache, and check the Apache error_log
for a line that says something like "SetHandler not allowed here", which
indicates the problem is .htaccess.  If so, check the directory section
of httpd.conf as described in step 5 above.  If not, try resetting the
permissions on the kn_events directory recursively:

  cd /path/to/apache/htdocs/mod_pubsub
  chmod -R a+w kn_events


You can see Perl source when you view test apps
  cgi-bin is not being parsed correctly.  In error_log, you'll see Apache
looking for but not finding /path/to/mod_pubsub/kn.  In debug mode, both
panels will be 404s.  Check the directory section of httpd.conf as described
in step 5 above.
  If other windows are OK but Perl is not being parsed, make sure kn_events
directory is a+w all the way down.

--------------------
Setting Up Newsfeeds
--------------------

The newsticker app works fine when set up as above, but there's no news
for it to display; you'll need to run a newsfeed script.  There's a
simple one provided in mod_pubsub/kn_sense/rss.plx; you can run it as
follows:

  cd mod_pubsub/kn_sense
  ./rss.plx -url http://localhost/mod_pubsub/cgi-bin/kn.cgi

This fetches a large number of RSS files and posts their contents as
stories to the server; when you do this, you should start seeing
headlines show up in NewsTicker almost immediately.

It will eventually finish; if you want a continuous newsfeed, you
should run rss.plx periodically.


--------------------
For More Information
--------------------

Read TODO to see all the things we want to add and improve.
Read README for a list of credits.

And: Join the mailing lists to work with the community on making this
project much better.
